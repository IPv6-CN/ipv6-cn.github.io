---
layout: post
title: "运营商 IPv6 地址规划设计（翻译资料）"
categories: [other, addressing]
author: "Ryan McCann —— Clearcable Connects 总裁"
---
原文链接：[TEAM ARIN blog: IPv6 Addressing Plan Design For Service Providers](https://teamarin.net/2018/07/05/ipv6-addressing-plan-design-for-service-providers/)

译者：兰世战、张连成、宋崟川

编辑：宋崟川

## Clearcable IPv6 案例研究

### 背景

21世纪初商业 IPv6 产品出现以来，Clearcable 就一直参与 IPv6 的发展。早期主要是 IPv6 的测试、试验和实验室使用。然而到了 2008 年，我们就发起了一项活动，开始为我们的客户（运营商）传授 IPv6 知识，并强调着手实施 IPv6 必要性。

说服客户部署和使用 IPv6 是一项艰巨的任务，我们并没有取得很大进展。不过在一些客户（运营商）那里我们还是获得了足够的批准以继续推进。是这样开始的，让每个客户 ISP 都从 ARIN 直接获得他们自己的 /32 前缀（这是为 ISP 分配的标准大小），然后我们在每个客户 ISP 的核心网络中配置IPv6。一般这意味着固件升级，还有当时我们如果能获得 BGP 穿透带宽（BGP transit peer）就建立 peering，或者通过其他有（原生） IPv6 和/或 HE.net（6in4 tunnel broker）隧道的互联网交换点（IXP）的成员。

2010 年，我们推出了 SOE4 私有云平台，一开始的设计上就支持 IPv6。这些平台推广的时候我们就尽可能通过 HE 隧道提供 IPv6 访问，随着越来越多的服务提供商有了原生 IPv6，我们将服务器平台迁移到原生 IPv6。

同样是在 2010 年，我在 Clearcable 的技术年会上介绍了 IPv6，包括背景、驱动力以及如何实施。这激起了大家的一些额外兴趣，但这还远远不够。从那时起我们继续与行业组织和供应商合作推广 IPv6，还开发设计了实现策略、用例和支撑性的基础设施，例如我们的支持 DNS64 和 NAT64 服务的 IPv6 过渡设备。

我们还认识到，我们必须要规划一个标准且合理的 IPv6 地址分配方案，以帮助服务提供商部署 IPv6。我们打造了两个方向的规划，分别针对运营商和内容提供商/企业。我们在地址分配方面主要的目标是构建一个使地址管理自动化以及减少未来重新编址工作的框架。

### 运营商顶层设计

几个重要理念：

* 简洁合理
* 尽可能维护 4 bit(nibble) 边界
* 为路由和安全 ACL 保持最大可能的聚合
* 新地址中嵌入现有系统的属性
* 尽可能减少未来重编址工作

作为我们 IPv6 地址规划设计的一部分，我们为中小运营商设计了标准的接入层技术对照表，如下所示：

|ID|二进制|前缀长度|描述|
|---|---|---|---|
|0|0000|34|保留|
|8|1000|34|DOCSIS CMTS|
|4|0100|34|GPON OLT|
|C|1100|34|其他（见下表）|

|ID|二进制|前缀长度|描述|
|---|---|---|---|
|C|1100|36|DSL DSLAM|
|E|1110|36|无线|
|D|1101|36|直连光纤|
|F|1111|36|接入技术无关 静态 /48 和 /56|

以 DOCSIS 为例，我们有一个预留了一个 /34 的前缀。从这个 /34 的前缀，我们为一个区域或 PoP 站点分配一个 /36 前缀，然后为每个 DOCSIS CMTS 分配单独的 /40 前缀（一个 /36 前缀可以分配 16 个 /40 前缀）。

如果我们需要更多的接入技术选择，就增加前面有效位数的长度。**（译者按：这种编址理念请参考 RFC 3531）**

如果单一访问技术需要更多设备，我们会将 DOCSIS 中的网络掩码扩展，例如十六进制 A（二进制 1010）。所以这样十六进制 8 和 A 都指代一个 DOCSIS CMTS，但它们仍然能够在同一个 /34 下聚合（即我们不必在路由中列出两个单独的 /36 前缀地址块）。

### 分配给最终用户的地址块
我们还设计了标准的最终用户分配方案：

* /56 住宅和中小企业
* /48 内容提供商和大企业
* /64 服务提供商基础设施
* /64 接入技术无关的网络
* /128 环回接口上的地址

从一个家庭用户的角度看，一个 /56 的前缀块大约相当于 IPv4 的 /20，8 位的可用地址空间等于 265 个子网。一般只有 00 网络被使用，例如 `2001:db8:1234:56`__`00`__`:020c:29ff:fe0c:47d5/64` 这样的地址，然而更高级的设置可能使用 01，02 等等，每个接口一个 /64，比如：千兆以太网、WiFi，安全系统、IP 电视等等。**（译者按：建议保留全 0 和全 1 的地址暂不分配，防止误解。）**

地址下发模式的例子：

`2001:0db8:80`__`34:56`__`00::/56`

* 0x8 = DOCSIS
* 0x0 = 一号CMTS
* 家庭订户 ID = 0x __3456__

`2001:0db8:403`__`4:56`__`00::/56`

1. 0x4 = GPON
2. 0x03 = 四号OLT
3. 家庭订户 ID =0x __456__

基于 VLAN 的部署中，VLAN ID(VID) 有 12 比特，我们可以把转成 16 进制的 VID 映射到 4 个 nibble（4bit）中的后三段。

例如 :0678: 中打头的 0x0 表示这是一个 VLAN 映射，后面的 0x678 代表 VLAN 1656（十进制）。

举一个运营商自己基础设施中的例子，`2001:0db8:`__`0000`__`:0678::/64` 中的 __`0000`__ 表示内部的基础设施，VLAN ID 是 0x678 = 1656。

### 稀疏地址分配和灵活的位分配
除了标准化的“技术-地址对照表”和最终用户分配之外，我们的地址规划中的另外两个重要设计决策是使用稀疏地址分配，并遵循 RFC 3531 的准则进行灵活的位分配。

这使得我们一方面可以尽可能推迟网络边界的固化，另一方面得以保持更大范围的聚合。

顺序分配时，左侧字段我们从左边的比特开始分配，例如 0000, 1000, 0100, 1100。这就为我们路由器或网络数量的增长预留了空间。举例：R00N 可以变成：RRRN 或 RRNN 或 RNNN。

我们还为链路本地，组播，NAT64，环回，点对点及其他特殊地址构建了 IPv6 地址规划。

其他的最佳实践：

* 遵从 [RFC 5952]({% link references/RFCs/RFC5952.md %}) 的地址表示法
* 首选 SLAAC 进行地址合成
* 松散/稀疏分配以适应增长需求
* 使用统一一致的地址下发/委派模式
* 使用 [RFC 3531]({% link references/RFCs/RFC3531.md %}) 中的地址分配方法推迟子网划分的决策
* 认识特殊地址存在的目的

### 总结

总之，无论最好采取哪种 IPv6 地址分配方案，关键是要有个方案，而且是提前规划好，并与所有关键的利益相关者分享（包括培训），然后按这个方案推行。

ARIN，互联网协会（Internet Society）等行业组织与许多内容提供商（如谷歌和 Facebook）一道，在推动 IPv6 过程中发挥了重要作用。过去几年，我们终于看到了服务提供商能认真对待 IPv6。在我们开始推动 IPv6 十年之际，几乎所有服务提供商客户都在一定程度上部署了 IPv6，并积极计划继续推进他们的 IPv6 实施。

## 作者简介
Ryan McCann，CLEARCABLE CONNECTS 总裁

[https://www.clearcable.ca](https://www.clearcable.ca)

Ryan McCann 是 Clearcable Connects 的总裁。Clearcable 是一家专业的电信技术咨询公司，专注于服务提供商的需求——开发新的业务收入流，维护现有基础设施，并推动全球电信领域新的发展。包括 IPv6 咨询和培训服务。

------

### 译者对本翻译稿的转载要求：
1. 保留完整译文（包括“本转载要求”以上所有内容）
2. 注明作者和译者
3. 注明译文链接：https://www.ipv6-cn.com/references/clearcable-IPv6-addressing-case-study.html
4. 注明英文原文链接：https://teamarin.net/2018/07/05/ipv6-addressing-plan-design-for-service-providers/

本译文已获得原作者授权。